<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選手記録管理</title> <!-- タイトルを変更 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.jsの読み込み -->
    <script src="athletePage.js" defer></script>
</head>
<body>
    <h1 id="athlete-name">選手記録</h1>

    <!-- 記録入力 -->
    <section id="record-entry">
        <h2>選手を選んで記録を入力</h2>
        <form id="register-athlete-form">
            <input type="text" id="new-athlete-name" placeholder="選手名を入力">
            <button type="submit">選手登録</button>
        </form>

        <label for="athlete-select">選手を選択：</label>
        <select id="athlete-select" multiple></select>

        <label for="event-select">種目を選択：</label>
        <select id="event-select">
            <option value="running">ダッシュ</option>
            <option value="load_running">負荷走</option>
            <option value="acceleration_running">加速走</option>
            <option value="hurdles">ハードル</option>
            <option value="long_jump">走幅跳</option>
            <option value="high_jump">走高跳</option>
            <option value="triple_jump">三段跳</option>
            <option value="javelin_throw">やり投げ</option>
            <option value="discus_throw">円盤投</option>
        </select>

        <div id="distance-section">
            <label for="distance-select">距離を選択：</label>
            <select id="distance-select">
                <option value="30">30m</option>
                <option value="50">50m</option>
                <option value="70">70m</option>
                <option value="100">100m</option>
                <option value="120">120m</option>
                <option value="150">150m</option>
                <option value="200">200m</option>
                <option value="250">250m</option>
                <option value="300">300m</option>
                <option value="400">400m</option>
                <option value="manual">手動</option>
            </select>
        </div>

        <label for="record-count">本数を選択：</label>
        <select id="record-count">
            <option value="1">1回</option>
            <option value="2">2回</option>
            <option value="3">3回</option>
            <option value="4">4回</option>
            <option value="5">5回</option>
        </select>

        <button id="add-selected-athletes">選手を追加</button>
    </section>

    <!-- 記録のグラフ表示 -->
    <section id="record-chart">
        <h2>記録グラフ</h2>
        <canvas id="athlete-record-chart"></canvas> <!-- グラフを表示するキャンバス -->
    </section>


    <!-- 選手個人ページへのリンク -->
    <section id="athletes-links">
        <h2>選手のページ</h2>
        <ul id="athletes-list"></ul> <!-- 選手名リンク一覧 -->
    </section>

    <!-- 記録の一覧 -->
    <section id="record-table">
        <h2>記録</h2>
        <table>
            <thead>
                <tr>
                    <th>選手名</th>
                    <th>種目</th>
                    <th>距離</th>
                    <th>タイム・記録</th>
                    <th>本数</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="record-table-body">
                <!-- 選手ごとの記録行を動的に追加 -->
            </tbody>
        </table>
        <button onclick="addNewRecordRow()">新しい選手の記録を追加</button>
    </section>

    <script>
        // 記録データを格納するための配列
        let records = [];

        // 新しい記録行を追加する関数
        function addNewRecordRow() {
            const playerId = records.length + 1; // 新しいプレイヤーIDを作成

            // 記録を追加
            records.push({
                playerId: playerId,
                name: `選手${playerId}`, // 選手名 (例: 選手1, 選手2)
                event: '',
                distance: '',
                records: [],
                count: 1
            });

            renderTable();
        }

        // 記録テーブルを再描画する関数
        function renderTable() {
            const tbody = document.getElementById('record-table-body');
            tbody.innerHTML = ''; // 既存のテーブル行をクリア

            records.forEach((record, index) => {
                const tr = document.createElement('tr');
                
                // 選手名
                tr.innerHTML += `<td>${record.name}</td>`;
                
                // 種目
                tr.innerHTML += `<td><input type="text" value="${record.event}" onchange="updateRecordField(${index}, 'event', this.value)" placeholder="種目名"></td>`;
                
                // 距離
                tr.innerHTML += `<td><input type="text" value="${record.distance}" onchange="updateRecordField(${index}, 'distance', this.value)" placeholder="距離"></td>`;
                
                // 記録入力（本数に応じた入力フィールド）
                let recordInputs = '';
                for (let i = 0; i < record.count; i++) {
                    recordInputs += `<input type="text" value="${record.records[i] || ''}" onchange="updateRecordField(${index}, 'records', this.value, ${i})" placeholder="タイム・記録 ${i+1}">`;
                }
                tr.innerHTML += `<td>${recordInputs}</td>`;
                
                // 本数入力と変更
                tr.innerHTML += `<td><input type="number" value="${record.count}" onchange="updateRecordField(${index}, 'count', this.value)"></td>`;
                
                // 操作ボタン（新しい距離の記録を追加する）
                tr.innerHTML += `<td><button onclick="addRecordForPlayer(${index})">新しい距離の記録を追加</button></td>`;

                tbody.appendChild(tr);
            });
        }

        // 記録フィールドを更新する関数
        function updateRecordField(playerIndex, field, value, recordIndex = null) {
            if (field === 'count') {
                // 本数を変更した場合、入力フィールドの数を調整
                records[playerIndex].count = parseInt(value);
                records[playerIndex].records.length = parseInt(value);
            } else if (field === 'records' && recordIndex !== null) {
                // 特定の記録フィールドを更新
                records[playerIndex].records[recordIndex] = value;
            } else {
                // その他のフィールド（選手名や種目、距離）
                records[playerIndex][field] = value;
            }
            renderTable();
        }

        // 新しい距離の記録を追加する関数
        function addRecordForPlayer(playerIndex) {
            records[playerIndex].count++;
            records[playerIndex].records.push('');
            renderTable();
        }
    </script>

    <script>
        // 選手個人ページへのリンクを生成
        function generateAthletesLinks() {
            const athleteData = getAthleteData();
            const athletesList = document.getElementById('athletes-list');
            athletesList.innerHTML = '';  // 既存のリンクをクリア

            // 選手名ごとにリンクを作成
            for (const name in athleteData) {
                const listItem = document.createElement('li');
                const athleteLink = document.createElement('a');
                athleteLink.href = `athletePage.html?name=${name}`;  // 各選手のページURL
                athleteLink.textContent = name;
                listItem.appendChild(athleteLink);
                athletesList.appendChild(listItem);
            }
        }

        // ページ読み込み時にリンクを表示
        document.addEventListener('DOMContentLoaded', function() {
            generateAthletesLinks();
        });
    </script>
</body>
</html>

